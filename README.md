# DiabetesKidney Companion

**MedGemma Impact Challenge 2025 â€” Kaggle Hackathon Submission**

An AI-powered clinical decision support tool that helps patients with diabetes and chronic kidney disease (CKD) understand how their blood glucose control relates to kidney health and medication safety.

## Overview

Patients managing both diabetes and CKD face complex medication interactions and lab monitoring requirements. DiabetesKidney Companion uses Google's MedGemma model to:

1. **Extract structured data** from lab report images
2. **Generate medication safety alerts** based on KDIGO guidelines
3. **Produce patient-friendly explanations** of lab results and their clinical significance

## Features

- ğŸ”¬ **Lab Report Extraction**: OCR-free extraction using MedGemma's vision capabilities
- âš ï¸ **Medication Safety Alerts**: Rule-based alerts across 5 categories (nephrotoxic drugs, contraindications, CKD monitoring, glycemic interactions, electrolyte-medication interactions)
- ğŸ“‹ **Patient Explanations**: Plain-language summaries generated by MedGemma 27B
- ğŸ“Š **CKD Staging**: Automatic staging using CKD-EPI 2021 equation

## Pipeline

```
Script 1: Setup & Test     â†’ Load MedGemma, validate single extraction
Script 2: Batch Extraction â†’ Process cohort of lab report images
Script 3: Safety Alerts    â†’ Apply KDIGO guidelines, generate alerts
Script 4: Explanations     â†’ Generate patient-friendly summaries
```

## Requirements

### Hardware
- NVIDIA GPU with â‰¥55GB VRAM (for MedGemma 27B)

### Software
- Python 3.10+
- CUDA 12.1+ (tested with CUDA 13.1)
- See `requirements.txt` for Python dependencies

## Installation

```bash
# Clone repository
git clone https://github.com/UdamLiyanage/DiabetesKidneyCompanion.git
cd diabeteskidney-companion

# Create virtual environment (recommended)
python -m venv venv
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Set Hugging Face cache directory (optional, for large storage)
export HF_HOME=/path/to/cache
```

## Usage

### 1. Setup and Test
```bash
python setup_and_test.py
```
Loads MedGemma and validates extraction on test images.

### 2. Batch Extraction
```bash
python batch_extraction.py
```
Processes all lab report images in `synthetic_output/images/`.

### 3. Generate Safety Alerts
```bash
python medication_alerts.py
```
Applies KDIGO guidelines to extracted lab data and medications.

### 4. Generate Patient Explanations
```bash
python patient_explanations.py
```
Creates patient-friendly summaries using MedGemma 27B.

## Project Structure

```
diabeteskidney-companion/
â”œâ”€â”€ setup_and_test.py        # Model loading and validation
â”œâ”€â”€ batch_extraction.py      # Batch lab report extraction
â”œâ”€â”€ medication_alerts.py     # Medication safety alert generation
â”œâ”€â”€ patient_explanations.py  # Patient explanation generation
â”œâ”€â”€ data_extraction/           # MIMIC-IV BigQuery scripts (optional)
â”‚   â”œâ”€â”€ README.md              # Data extraction documentation
â”‚   â”œâ”€â”€ quick_explore.py       # Verify BigQuery access
â”‚   â”œâ”€â”€ extract_diabetes_ckd_cohort.py  # Main extraction
â”‚   â””â”€â”€ analyze_cohort.py      # CKD staging & profiles
â”œâ”€â”€ synthetic_output/          # Input data
â”‚   â”œâ”€â”€ images/                # Lab report images (PNG)
â”‚   â””â”€â”€ patients/              # Ground truth JSON files
â”œâ”€â”€ output/                    # Pipeline outputs
â”‚   â”œâ”€â”€ extractions/           # Extracted lab data
â”‚   â”œâ”€â”€ alerts/                # Safety alerts
â”‚   â””â”€â”€ explanations/          # Patient explanations
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## Demo Cases

Three demonstration cases representing different complexity levels:

| Case | CKD Stage | HbA1c | Key Features |
|------|-----------|-------|--------------|
| SYN-0001 | G3a | 7.2% | Baseline case, moderate complexity |
| SYN-0050 | G4 | 8.5% | Advanced CKD, medication adjustments needed |
| SYN-0190 | G5 | 9.1% | Complex case, multiple alerts |

## Data Sources

- **MIMIC-IV**: Real clinical data distributions (via PhysioNet/BigQuery)
- **Synthetic Lab Reports**: Generated with realistic value distributions from MIMIC-IV cohort analysis

### Cohort Statistics
- 14,815 patients with both diabetes and CKD
- Lab values and medications reflect real-world clinical patterns

### Data Extraction (Optional)
The `data_extraction/` folder contains scripts to reproduce the MIMIC-IV cohort extraction. These require PhysioNet credentialed access â€” see [data_extraction/README.md](data_extraction/README.md) for details.

## Clinical Guidelines

Medication safety alerts follow:
- **KDIGO 2024**: Chronic Kidney Disease guidelines
- **ADA Standards of Care**: Diabetes management
- **FDA labeling**: Medication-specific contraindications

## Performance

| Metric | Result |
|--------|--------|
| Extraction Success Rate | 90.8% (177/195) |
| Lab Value Accuracy | 84.9% |
| Alert Generation | 100% |
| Explanation Generation | 100% |

## Limitations

- Requires high-end GPU hardware for MedGemma 27B
- Synthetic lab reports may not capture all real-world variations
- Alerts are informational only â€” not a substitute for clinical judgment
- MIMIC-IV ICU context means high proportion of acute kidney injury

## Acknowledgments

- [Google MedGemma](https://ai.google.dev/gemma/docs/medgemma) â€” Medical AI model
- [MIMIC-IV](https://physionet.org/content/mimiciv/) â€” Clinical data (PhysioNet)
- [KDIGO](https://kdigo.org/) â€” Clinical practice guidelines

## License

MIT License â€” see LICENSE file

---

*Built for the MedGemma Impact Challenge 2025*
